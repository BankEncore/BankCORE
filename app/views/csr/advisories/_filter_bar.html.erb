<% filter_params = local_assigns[:filter_params] || {} %>
<% scope_record = local_assigns[:scope_record] %>
<% form_url = scope_record ? (scope_record.is_a?(Party) ? csr_party_advisories_path(scope_record) : csr_account_advisories_path(scope_record)) : csr_advisories_path %>

<%= form_with url: form_url, method: :get, local: true, class: "mb-4" do |f| %>
  <div class="card bg-base-100 border border-base-300">
    <div class="card-body py-3">
      <h3 class="card-title text-sm font-medium mb-3">Filters</h3>
      <div class="flex flex-wrap gap-4 items-end">
        <% if scope_record.nil? %>
          <div class="form-control">
            <%= f.label :scope_type, "Linked type", class: "label label-text text-xs" %>
            <%= f.select :scope_type,
                  options_for_select([ [ "All", "" ], [ "Parties only", "party" ], [ "Accounts only", "account" ] ], filter_params[:scope_type]),
                  {},
                  class: "select select-bordered select-sm" %>
          </div>
        <% end %>
        <div class="form-control">
          <%= f.label :active_only, "Status", class: "label label-text text-xs" %>
          <%= f.select :active_only,
                options_for_select([ [ "Active only", "true" ], [ "All (include inactive)", "false" ] ], filter_params[:active_only].presence || "true"),
                {},
                class: "select select-bordered select-sm" %>
        </div>
        <div class="form-control">
          <%= f.label :category, "Category", class: "label label-text text-xs" %>
          <%= f.select :category,
                options_for_select([ [ "All", "" ] ] + %w[fraud compliance legal operational relationship monitoring].map { |c| [ c.titleize, c ] }, filter_params[:category]),
                {},
                class: "select select-bordered select-sm" %>
        </div>
        <div class="form-control">
          <%= f.label :severity, "Severity", class: "label label-text text-xs" %>
          <%= f.select :severity,
                options_for_select([ [ "All", "" ] ] + Advisory.severities.keys.map { |k| [ advisory_severity_label_for_enum(k), k ] }, filter_params[:severity]),
                {},
                class: "select select-bordered select-sm" %>
        </div>
        <div class="form-control">
          <%= f.label :pinned, "Pinned", class: "label label-text text-xs" %>
          <%= f.select :pinned,
                options_for_select([ [ "All", "" ], [ "Pinned only", "true" ] ], filter_params[:pinned]),
                {},
                class: "select select-bordered select-sm" %>
        </div>
        <div class="form-control">
          <%= f.label :created_from, "Created from", class: "label label-text text-xs" %>
          <%= f.date_field :created_from, value: filter_params[:created_from], class: "input input-bordered input-sm" %>
        </div>
        <div class="form-control">
          <%= f.label :created_to, "Created to", class: "label label-text text-xs" %>
          <%= f.date_field :created_to, value: filter_params[:created_to], class: "input input-bordered input-sm" %>
        </div>
        <div class="form-control">
          <%= f.label :starts_at, "Starts at", class: "label label-text text-xs" %>
          <%= f.date_field :starts_at, value: filter_params[:starts_at], class: "input input-bordered input-sm" %>
        </div>
        <div class="form-control">
          <%= f.label :ends_at, "Ends at", class: "label label-text text-xs" %>
          <%= f.date_field :ends_at, value: filter_params[:ends_at], class: "input input-bordered input-sm" %>
        </div>
        <div class="form-control">
          <%= f.submit "Apply", class: "btn btn-primary btn-sm" %>
        </div>
      </div>
    </div>
  </div>
<% end %>
