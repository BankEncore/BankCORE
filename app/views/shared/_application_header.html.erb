<%# Unified application header: BankCORE, workspace switcher, Switch Branch, Sign Out %>
<header class="border-b border-base-300 bg-base-100 no-print">
  <div class="mx-auto max-w-7xl px-4 py-3">
    <div class="navbar">
      <div class="flex items-center gap-3">
        <%= link_to "BankCORE", root_path, class: "font-semibold tracking-tight" %>

        <% if authenticated? %>
          <% workspaces = authorized_workspaces %>
          <% if workspaces.any? %>
            <details class="relative">
              <summary class="btn btn-ghost btn-sm cursor-pointer list-none [&::-webkit-details-marker]:hidden">
                <%= current_workspace_label %> â–¼
              </summary>
              <ul class="absolute left-0 z-10 mt-2 w-56 rounded-lg border border-base-300 bg-base-100 p-2 shadow-lg">
                <% workspaces.each do |ws| %>
                  <li>
                    <%= link_to ws[:name], ws[:path], class: ws[:active] ? "active block rounded px-3 py-2" : "block rounded px-3 py-2 hover:bg-base-200" %>
                  </li>
                <% end %>
              </ul>
            </details>
          <% else %>
            <span class="text-sm text-base-content/70">
              No workspaces.
              <%= link_to "Contact admin", "mailto:admin@bankcore.local", class: "link link-hover" %>
            </span>
          <% end %>
        <% end %>
      </div>

      <div class="flex items-center gap-2">
        <%= link_to "Switch Branch", switch_branch_path, class: "btn btn-ghost btn-sm" %>
        <% if authenticated? %>
          <%= button_to "Sign Out", session_path, method: :delete, class: "btn btn-primary btn-sm" %>
        <% else %>
          <%= link_to "Sign In", new_session_path, class: "btn btn-primary btn-sm" %>
        <% end %>
      </div>
    </div>
  </div>
</header>
