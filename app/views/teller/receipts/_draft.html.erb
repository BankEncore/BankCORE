<% meta = posting_batch.metadata || {} %>
<% meta = meta.with_indifferent_access if meta.respond_to?(:with_indifferent_access) %>
<% draft = meta["draft"] || meta[:draft] || {} %>
<% draft = draft.with_indifferent_access if draft.respond_to?(:with_indifferent_access) %>
<% instrument = (draft["instrument_number"] || draft[:instrument_number]).to_s %>
<% draft_amt = (draft["draft_amount_cents"] || draft[:draft_amount_cents] || 0).to_i %>
<% fee = (draft["fee_cents"] || draft[:fee_cents] || 0).to_i %>
<% total = draft_amt + fee %>
<% draft_cash = (draft["draft_cash_cents"] || draft[:draft_cash_cents] || 0).to_i %>
<% draft_account = (draft["draft_account_cents"] || draft[:draft_account_cents] || 0).to_i %>
<% draft_checks = check_items_from_metadata(posting_batch).sum { |i| (i["amount_cents"] || i[:amount_cents] || 0).to_i } %>
<% user = teller_transaction.user %>
<% payee = (draft["payee_name"] || draft[:payee_name]).to_s %>

<div class="receipt-type-details text-sm">
  <table class="table table-sm text-sm w-full">
    <tr>
      <td>Draft #:</td>
      <td class="tabular-nums text-right"><%= instrument.presence || "—" %></td>
    </tr>
    <tr>
      <td>Payee:</td>
      <td class="text-right"><%= payee.presence || "—" %></td>
    </tr>
    <tr>
      <td>Amount:</td>
      <td class="tabular-nums text-right"><%= receipt_money(draft_amt) %></td>
    </tr>
    <tr>
      <td>Fee:</td>
      <td class="tabular-nums text-right"><%= receipt_money(fee) %></td>
    </tr>
    <tr>
      <td class="font-semibold">Total Due:</td>
      <td class="tabular-nums text-right font-semibold"><%= receipt_money(total) %></td>
    </tr>
    <tr>
      <td>Cash:</td>
      <td class="tabular-nums text-right"><%= receipt_money(draft_cash) %></td>
    </tr>
    <tr>
      <td>Checks:</td>
      <td class="tabular-nums text-right"><%= receipt_money(draft_checks) %></td>
    </tr>
    <tr>
      <td>Account Transfer:</td>
      <td class="tabular-nums text-right"><%= receipt_money(draft_account) %></td>
    </tr>
  </table>
</div> 

<%= render "teller/receipts/receipt_account_info", posting_batch: posting_batch %>

<div class="receipt-auth mt-3 text-sm">
  <p>Auth: <%= user.teller_number.presence || teller_transaction.workstation&.code || "—" %> - <%= user.display_label %></p>
</div>
