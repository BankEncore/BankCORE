<%# Advisories tab content for Party or Account record screens %>
<% scope_record = local_assigns[:scope_record] %>
<% advisories_path = local_assigns[:advisories_path] %>
<% new_advisory_path = local_assigns[:new_advisory_path] %>
<% can_create = local_assigns.fetch(:can_create, false) %>

<section class="card bg-base-100 border border-base-300">
  <div class="card-body">
    <div class="flex items-start justify-between gap-3">
      <div>
        <h2 class="card-title text-base">Advisories</h2>
        <p class="text-xs text-slate-600 mt-1">Customer advisories for this <%= scope_record.is_a?(Party) ? "party" : "account" %>.</p>
      </div>
      <% if can_create %>
        <%= link_to "Add Advisory", new_advisory_path, class: "btn btn-primary btn-sm" %>
      <% end %>
    </div>
    <div class="divider my-3"></div>

    <% if advisories.any? %>
      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead>
            <tr class="row-border t-head">
              <th class="py-2 text-left">Category</th>
              <th class="py-2 text-left">Severity</th>
              <th class="py-2 text-left">Title</th>
              <th class="py-2 text-left">Effective</th>
              <th class="py-2 text-left">Created by</th>
              <th class="py-2 text-left">Pinned</th>
              <th class="py-2 text-right">Actions</th>
            </tr>
          </thead>
          <tbody>
            <% advisories.each do |advisory| %>
              <tr class="row-border">
                <td class="py-2"><%= advisory.category.presence&.titleize || "—" %></td>
                <td class="py-2">
                  <span class="badge badge-<%= advisory_severity_badge(advisory) %> badge-sm"><%= advisory_severity_label(advisory) %></span>
                </td>
                <td class="py-2"><%= advisory.title %></td>
                <td class="py-2 text-xs">
                  <%= advisory.effective_start_at&.strftime("%Y-%m-%d") || "—" %> – <%= advisory.effective_end_at&.strftime("%Y-%m-%d") || "—" %>
                </td>
                <td class="py-2"><%= advisory.created_by&.email_address || "—" %></td>
                <td class="py-2"><%= advisory.pinned? ? "Yes" : "—" %></td>
                <td class="py-2 text-right">
                  <% edit_path = scope_record.is_a?(Party) ? edit_teller_party_advisory_path(scope_record, advisory) : edit_teller_account_advisory_path(scope_record, advisory) %>
                  <%= link_to "Edit", edit_path, class: "btn btn-ghost btn-sm" %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    <% else %>
      <p class="text-sm text-slate-600">No active advisories.</p>
      <% if can_create %>
        <p class="text-sm mt-2"><%= link_to "Add the first advisory", new_advisory_path, class: "link link-hover" %></p>
      <% end %>
    <% end %>
  </div>
</section>
