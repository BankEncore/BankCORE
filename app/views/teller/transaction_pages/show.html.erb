<% workflow_form_controller = "#{@transaction_type.tr('_', '-')}-form" %>
<div id="teller-transaction-flow"
  data-controller="<%= workflow_form_controller %> line-items hold-modal reference-panel approval-panel advisory-panel live-account-panel tx-shell tx-keyboard tx-validation tx-posting"
  data-live-account-panel-account-reference-url-value="<%= teller_account_reference_path %>"
  data-live-account-panel-account-path-template-value="<%= teller_account_path('__ID__') %>"
  data-action="tx:changed-><%= workflow_form_controller %>#recalculate tx:recalc->reference-panel#refresh tx:recalc->live-account-panel#refresh tx:recalc->tx-shell#handleRecalc tx:validate-requested->tx-validation#handleValidateRequested tx:post-requested->tx-posting#handlePostRequested tx:post-after-advisory-><%= workflow_form_controller %>#handlePostAfterAdvisory tx:submit-requested->tx-shell#handleSubmitRequested tx:cancel-requested->tx-shell#handleCancelRequested tx:approval-required->approval-panel#show tx:approval-required->tx-shell#handleApprovalRequired tx:advisory-required->advisory-panel#show tx:advisory-cancelled->tx-shell#handleAdvisoryCancelled tx:approval-cleared->approval-panel#hide tx:approval-cleared->tx-shell#handleApprovalCleared tx:approval-granted-><%= workflow_form_controller %>#handleApprovalGranted tx:approval-granted->tx-shell#handleApprovalGranted tx:approval-error-><%= workflow_form_controller %>#handleApprovalError tx:approval-error->tx-shell#handleApprovalError tx:advisory-error-><%= workflow_form_controller %>#handleAdvisoryError tx:posting-started->tx-shell#handlePostingStarted tx:posted-success->tx-shell#handlePostedSuccess tx:posted-failed->tx-shell#handlePostedFailed"
  data-<%= workflow_form_controller %>-opening-cash-cents-value="<%= @teller_session.expected_cash_cents %>"
  data-<%= workflow_form_controller %>-default-transaction-type-value="<%= @transaction_type %>"
  data-<%= workflow_form_controller %>-validate-url-value="<%= teller_validate_transaction_path %>"
  data-<%= workflow_form_controller %>-account-reference-url-value="<%= teller_account_reference_path %>"
  data-<%= workflow_form_controller %>-account-history-url-value="<%= teller_account_history_path %>"
  data-<%= workflow_form_controller %>-workflow-schema-url-value="<%= teller_workflow_schema_path %>"
  data-<%= workflow_form_controller %>-receipt-url-template-value="<%= teller_receipt_path(request_id: "__REQUEST_ID__") %>"
  data-<%= workflow_form_controller %>-drawer-reference-value="<%= @teller_session.cash_location.present? ? "cash:#{@teller_session.cash_location.code}" : "" %>"
  data-approval-panel-approval-url-value="<%= teller_approvals_path %>"
  data-reference-panel-workflow-value="<%= workflow_form_controller %>"
  data-reference-panel-account-reference-url-value="<%= teller_account_reference_path %>"
  data-reference-panel-account-history-url-value="<%= teller_account_history_path %>"
  data-reference-panel-advisories-url-value="<%= teller_advisories_for_entity_path %>"
  data-reference-panel-last-account-url-value="<%= teller_last_transaction_primary_account_path %>"
  <% if %w[deposit withdrawal transfer draft check_cashing].include?(@transaction_type) %>
  data-reference-panel-last-served-party-url-value="<%= teller_last_transaction_served_party_path %>"
  <% end %>
  data-<%= workflow_form_controller %>-advisories-url-value="<%= teller_advisories_for_entity_path %>"
  data-advisory-panel-acknowledge-url-template-value="<%= teller_acknowledge_advisory_path('__ID__') %>">
  <%= render "teller/shared/page_header",
    title: @page_title,
    description: "#{@page_title} flow. Validate and post once balanced.",
    show_state_badge: true,
    initial_state: "Editing",
    workflow_form_controller: workflow_form_controller,
    secondary_button_action: "#{workflow_form_controller}#resetForm",
    secondary_button_label: "Cancel",
    show_primary_submit: true,
    primary_submit_label: "Post Transaction",
    primary_submit_form_id: "posting-form" %>

  <%= render "teller/dashboard/posting_workspace",
    teller_session: @teller_session,
    form_url: @form_url,
    cash_locations: @cash_locations,
    default_transaction_type: @transaction_type,
    workflow_form_controller: workflow_form_controller,
    show_transaction_type: false,
    parties: @parties || [],
    selected_party: @selected_party %>
</div>
