<% form = local_assigns.fetch(:form) %>
<% wfc = local_assigns.fetch(:workflow_form_controller) %>
<% label = local_assigns.fetch(:primary_account_label, "Primary Account") %>
<% required = local_assigns.fetch(:primary_account_required, true) %>
<% placeholder = local_assigns.fetch(:primary_account_placeholder, "Search party or account #, or type account number") %>

<div id="primary-account-search" class="contents" data-controller="primary-account-search"
     data-primary-account-search-search-url-value="<%= teller_transaction_search_path %>"
     data-primary-account-search-party-accounts-url-template-value="<%= accounts_teller_party_path('__ID__') %>"
     data-primary-account-search-account-reference-url-value="<%= teller_account_reference_path %>"
     data-primary-account-search-related-parties-url-template-value="<%= related_parties_teller_account_path('__ID__') %>">
  <div data-primary-account-search-target="relatedPartiesRow" class="form-control min-w-0 md:row-start-1 md:col-start-2" hidden>
    <label class="text-xs font-medium text-slate-700">Related parties (optional)</label>
    <select data-primary-account-search-target="relatedPartiesSelect"
            data-action="change->primary-account-search#selectRelatedPartyFromDropdown"
            class="select select-bordered w-full mt-1">
    </select>
  </div>
  <div class="form-control overflow-visible min-w-0 md:row-start-2 md:col-start-1" data-<%= wfc %>-target="primaryAccountRow">
    <%= form.label :primary_account_reference, label, class: "text-xs font-medium text-slate-700 block" %>
    <div class="relative overflow-visible">
      <%= form.text_field :primary_account_reference,
        data: {
          "#{wfc}_target": "primaryAccountReference",
          primary_account_search_target: "searchInput",
          action: "input->#{wfc}#recalculate input->primary-account-search#search input->primary-account-search#onInputFreeTyping blur->primary-account-search#onPrimaryAccountBlur"
        },
        required: required,
        class: "input input-bordered w-full",
        placeholder: placeholder,
        autocomplete: "off" %>
      <div data-primary-account-search-target="resultsList"
           class="absolute left-0 right-0 z-50 mt-1 w-full max-h-48 overflow-auto rounded bg-base-100 border border-base-300 shadow"
           hidden>
      </div>
    </div>
  </div>
  <div data-primary-account-search-target="partyAccountsRow" data-party-accounts-row class="form-control min-w-0 md:row-start-2 md:col-start-2" hidden>
    <label class="text-xs font-medium text-slate-700">Related accounts for <span data-primary-account-search-target="partyName" data-party-name></span></label>
    <select data-primary-account-search-target="accountSelect" data-party-account-select
            data-action="change->primary-account-search#selectAccountFromDropdown"
            class="select select-bordered w-full mt-1">
    </select>
  </div>
</div>
