<% form = local_assigns.fetch(:form) %>
<% selected_party = local_assigns[:selected_party] %>
<% cash_account_reference_value = local_assigns.fetch(:cash_account_reference_value, "") %>
<% wfc = local_assigns.fetch(:workflow_form_controller, "check-cashing-form") %>

<%= hidden_field_tag :transaction_type, "check_cashing", data: { "#{wfc}_target": "transactionType" } %>

<%= form.hidden_field :amount_cents, value: 0, data: { "#{wfc}_target": "amountCents" } %>
<%= form.hidden_field :cash_account_reference,
  value: cash_account_reference_value,
  data: { "#{wfc}_target": "cashAccountReference" } %>

<%= render "teller/forms/served_party_section",
  form: form,
  workflow_form_controller: wfc,
  selected_party: selected_party,
  hint: "Individual presenting the check(s)." %>

<section data-<%= wfc %>-target="checkCashingSection" class="mt-4">
  <div class="font-medium">Check Cashing Details</div>
  <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mt-3">
    <div class="form-control">
      <%= form.label :fee_cents, "Fee", class: "text-xs font-medium text-slate-700 block" %>
      <div data-controller="currency-input" data-action="input-><%= wfc %>#recalculate">
        <%= form.hidden_field :fee_cents, value: 0, data: { "#{wfc}_target": "feeCents", currency_input_target: "hiddenInput" } %>
        <input type="text" class="input input-bordered w-full" inputmode="decimal" placeholder="$0.00" aria-label="Fee" data-currency-input-target="displayInput" data-action="input->currency-input#input blur->currency-input#blur" id="<%= form.field_id(:fee_cents) %>" />
      </div>
      <span class="text-xs text-slate-600 mt-1 block">Optional fee withheld from payout.</span>
    </div>
  </div>

  <%= form.hidden_field :fee_income_account_reference,
    value: "income:check_cashing_fee",
    data: { "#{wfc}_target": "feeIncomeAccountReference" } %>
</section>

<%= render "teller/forms/check_section", workflow_form_controller: wfc %>

<%= render "teller/forms/computed_totals", show_cash_back: false, workflow_form_controller: wfc %>
